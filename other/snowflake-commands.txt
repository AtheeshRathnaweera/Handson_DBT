CREATE ROLE DB_USER;

show roles;

SHOW DATABASE ROLES IN DATABASE HANDSON_DBT_DB;

GRANT ALL ON DATABASE HANDSON_DBT_DB to ROLE DB_USER;

GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA HANDSON_DBT_DB.public TO DB_USER;

GRANT ALL ON ALL schemas in database HANDSON_DBT_DB TO ROLE DB_USER; 

GRANT ALL ON ALL TABLES IN SCHEMA HANDSON_DBT_DB.PUBLIC TO ROLE DB_USER; 

grant select on all tables in schema HANDSON_DBT_DB.PUBLIC to role DB_USER;

CREATE TABLE HANDSON_DBT_DB.PUBLIC.test_table (
  id INT PRIMARY KEY, -- Column definition (data type, constraints)
  name VARCHAR(100) NOT NULL, -- Another column definition
  created_at TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP() -- Column with default value
);

show users;

SHOW WAREHOUSES;

GRANT USAGE ON WAREHOUSE COMPUTE_WH to ROLE DB_USER;

-- create audits table

CREATE TABLE IF NOT EXISTS HANDSON_DBT_DB.PUBLIC.dbt_audits (
  id INT AUTOINCREMENT START 1 INCREMENT 1,
  audit_type VARCHAR(50),
  created_at TIMESTAMP_TZ DEFAULT CURRENT_TIMESTAMP()
);

INSERT INTO HANDSON_DBT_DB.PUBLIC.dbt_audits (audit_type) values ('run_end');

SELECT * FROM HANDSON_DBT_DB.PUBLIC.dbt_audits;

-- create store_months table

create or replace TABLE HANDSON_DBT_DB.PUBLIC.STORE_MONTHS (
  ID NUMBER(38,0) autoincrement start 1 increment 1,
	NAME VARCHAR(100) NOT NULL,
	CREATED_AT TIMESTAMP_TZ(9) DEFAULT CURRENT_TIMESTAMP()
);

INSERT INTO HANDSON_DBT_DB.PUBLIC.STORE_MONTHS (NAME) VALUES ('Janurary'), ('February'), ('March');

SELECT
    *,
    datediff(min, created_at, CURRENT_TIMESTAMP()) as min_since_insert
FROM HANDSON_DBT_DB.PUBLIC.STORE_MONTHS;